import{c as We,ar as Ee,r as R,as as Qt,at as Ye,au as $e,u as qe,I as Ke,aa as ze,ac as He,j as L,av as Ge,aw as Xe,B as Qe,ax as Ze}from"./main-DsOtDJLA.js";import{s as tr}from"./index-C_CEyp_5.js";import{C as er}from"./chevrons-up-down-LGjGe9u3.js";/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],nr=We("info",rr);var _e="vercel.ai.error",sr=Symbol.for(_e),Ie,ar=class we extends Error{constructor({name:e,message:r,cause:n}){super(r),this[Ie]=!0,this.name=e,this.cause=n}static isInstance(e){return we.hasMarker(e,_e)}static hasMarker(e,r){const n=Symbol.for(r);return e!=null&&typeof e=="object"&&n in e&&typeof e[n]=="boolean"&&e[n]===!0}};Ie=sr;var dt=ar;function be(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Se="AI_InvalidArgumentError",Te=`vercel.ai.error.${Se}`,or=Symbol.for(Te),Re,ir=class extends dt{constructor({message:t,cause:e,argument:r}){super({name:Se,message:t,cause:e}),this[Re]=!0,this.argument=r}static isInstance(t){return dt.hasMarker(t,Te)}};Re=or;var Ae="AI_JSONParseError",Ce=`vercel.ai.error.${Ae}`,cr=Symbol.for(Ce),xe,oe=class extends dt{constructor({text:t,cause:e}){super({name:Ae,message:`JSON parsing failed: Text: ${t}.
Error message: ${be(e)}`,cause:e}),this[xe]=!0,this.text=t}static isInstance(t){return dt.hasMarker(t,Ce)}};xe=cr;var ve="AI_TypeValidationError",Ne=`vercel.ai.error.${ve}`,lr=Symbol.for(Ne),De,ur=class Jt extends dt{constructor({value:e,cause:r}){super({name:ve,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${be(r)}`,cause:r}),this[De]=!0,this.value=e}static isInstance(e){return dt.hasMarker(e,Ne)}static wrap({value:e,cause:r}){return Jt.isInstance(r)&&r.value===e?r:new Jt({value:e,cause:r})}};De=lr;var ie=ur;let fr=(t,e=21)=>(r=e)=>{let n="",a=r|0;for(;a--;)n+=t[Math.random()*t.length|0];return n};var ot={exports:{}},ce;function dr(){if(ce)return ot.exports;ce=1;const t=typeof Buffer<"u",e=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,r=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(l,s,o){o==null&&s!==null&&typeof s=="object"&&(o=s,s=void 0),t&&Buffer.isBuffer(l)&&(l=l.toString()),l&&l.charCodeAt(0)===65279&&(l=l.slice(1));const p=JSON.parse(l,s);if(p===null||typeof p!="object")return p;const u=o&&o.protoAction||"error",g=o&&o.constructorAction||"error";if(u==="ignore"&&g==="ignore")return p;if(u!=="ignore"&&g!=="ignore"){if(e.test(l)===!1&&r.test(l)===!1)return p}else if(u!=="ignore"&&g==="ignore"){if(e.test(l)===!1)return p}else if(r.test(l)===!1)return p;return a(p,{protoAction:u,constructorAction:g,safe:o&&o.safe})}function a(l,{protoAction:s="error",constructorAction:o="error",safe:p}={}){let u=[l];for(;u.length;){const g=u;u=[];for(const d of g){if(s!=="ignore"&&Object.prototype.hasOwnProperty.call(d,"__proto__")){if(p===!0)return null;if(s==="error")throw new SyntaxError("Object contains forbidden prototype property");delete d.__proto__}if(o!=="ignore"&&Object.prototype.hasOwnProperty.call(d,"constructor")&&Object.prototype.hasOwnProperty.call(d.constructor,"prototype")){if(p===!0)return null;if(o==="error")throw new SyntaxError("Object contains forbidden prototype property");delete d.constructor}for(const S in d){const y=d[S];y&&typeof y=="object"&&u.push(y)}}}return l}function i(l,s,o){const p=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(l,s,o)}finally{Error.stackTraceLimit=p}}function f(l,s){const o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(l,s,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=o}}return ot.exports=i,ot.exports.default=i,ot.exports.parse=i,ot.exports.safeParse=f,ot.exports.scan=a,ot.exports}var pr=dr();const hr=Ee(pr);var gr=({prefix:t,size:e=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const a=fr(r,e);if(t==null)return a;if(r.includes(n))throw new ir({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return i=>`${t}${n}${a(i)}`},Zt=gr(),Ut=Symbol.for("vercel.ai.validator");function mr(t){return{[Ut]:!0,validate:t}}function yr(t){return typeof t=="object"&&t!==null&&Ut in t&&t[Ut]===!0&&"validate"in t}function Er(t){return yr(t)?t:_r(t)}function _r(t){return mr(e=>{const r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Ir({value:t,schema:e}){const r=Er(e);try{if(r.validate==null)return{success:!0,value:t};const n=r.validate(t);return n.success?n:{success:!1,error:ie.wrap({value:t,cause:n.error})}}catch(n){return{success:!1,error:ie.wrap({value:t,cause:n})}}}function le({text:t,schema:e}){try{const r=hr.parse(t);if(e==null)return{success:!0,value:r,rawValue:r};const n=Ir({value:r,schema:e});return n.success?{...n,rawValue:r}:n}catch(r){return{success:!1,error:oe.isInstance(r)?r:new oe({text:t,cause:r})}}}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var gt={code:"0",name:"text",parse:t=>{if(typeof t!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:t}}},mt={code:"3",name:"error",parse:t=>{if(typeof t!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:t}}},yt={code:"4",name:"assistant_message",parse:t=>{if(t==null||typeof t!="object"||!("id"in t)||!("role"in t)||!("content"in t)||typeof t.id!="string"||typeof t.role!="string"||t.role!=="assistant"||!Array.isArray(t.content)||!t.content.every(e=>e!=null&&typeof e=="object"&&"type"in e&&e.type==="text"&&"text"in e&&e.text!=null&&typeof e.text=="object"&&"value"in e.text&&typeof e.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:t}}},Et={code:"5",name:"assistant_control_data",parse:t=>{if(t==null||typeof t!="object"||!("threadId"in t)||!("messageId"in t)||typeof t.threadId!="string"||typeof t.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:t.threadId,messageId:t.messageId}}}},_t={code:"6",name:"data_message",parse:t=>{if(t==null||typeof t!="object"||!("role"in t)||!("data"in t)||typeof t.role!="string"||t.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:t}}},wr=[gt,mt,yt,Et,_t];gt.code+"",mt.code+"",yt.code+"",Et.code+"",_t.code+"";gt.name+"",gt.code,mt.name+"",mt.code,yt.name+"",yt.code,Et.name+"",Et.code,_t.name+"",_t.code;wr.map(t=>t.code);function br({promptTokens:t,completionTokens:e}){return{promptTokens:t,completionTokens:e,totalTokens:t+e}}function Sr(t){const e=["ROOT"];let r=-1,n=null;function a(s,o,p){switch(s){case'"':{r=o,e.pop(),e.push(p),e.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=o,n=o,e.pop(),e.push(p),e.push("INSIDE_LITERAL");break}case"-":{e.pop(),e.push(p),e.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=o,e.pop(),e.push(p),e.push("INSIDE_NUMBER");break}case"{":{r=o,e.pop(),e.push(p),e.push("INSIDE_OBJECT_START");break}case"[":{r=o,e.pop(),e.push(p),e.push("INSIDE_ARRAY_START");break}}}function i(s,o){switch(s){case",":{e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=o,e.pop();break}}}function f(s,o){switch(s){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=o,e.pop();break}}}for(let s=0;s<t.length;s++){const o=t[s];switch(e[e.length-1]){case"ROOT":a(o,s,"FINISH");break;case"INSIDE_OBJECT_START":{switch(o){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}case"}":{r=s,e.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(o){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(o){case'"':{e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(o){case":":{e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(o,s,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{i(o,s);break}case"INSIDE_STRING":{switch(o){case'"':{e.pop(),r=s;break}case"\\":{e.push("INSIDE_STRING_ESCAPE");break}default:r=s}break}case"INSIDE_ARRAY_START":{switch(o){case"]":{r=s,e.pop();break}default:{r=s,a(o,s,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(o){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=s,e.pop();break}default:{r=s;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(o,s,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{e.pop(),r=s;break}case"INSIDE_NUMBER":{switch(o){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=s;break}case"e":case"E":case"-":case".":break;case",":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&f(o,s),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&i(o,s);break}case"}":{e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&i(o,s);break}case"]":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&f(o,s);break}default:{e.pop();break}}break}case"INSIDE_LITERAL":{const u=t.substring(n,s+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?i(o,s):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&f(o,s)):r=s;break}}}let l=t.slice(0,r+1);for(let s=e.length-1;s>=0;s--)switch(e[s]){case"INSIDE_STRING":{l+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{l+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{l+="]";break}case"INSIDE_LITERAL":{const p=t.substring(n,t.length);"true".startsWith(p)?l+="true".slice(p.length):"false".startsWith(p)?l+="false".slice(p.length):"null".startsWith(p)&&(l+="null".slice(p.length))}}return l}function ke(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=le({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=le({text:Sr(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Tr={code:"0",name:"text",parse:t=>{if(typeof t!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:t}}},Rr={code:"2",name:"data",parse:t=>{if(!Array.isArray(t))throw new Error('"data" parts expect an array value.');return{type:"data",value:t}}},Ar={code:"3",name:"error",parse:t=>{if(typeof t!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:t}}},Cr={code:"8",name:"message_annotations",parse:t=>{if(!Array.isArray(t))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:t}}},xr={code:"9",name:"tool_call",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("toolName"in t)||typeof t.toolName!="string"||!("args"in t)||typeof t.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:t}}},vr={code:"a",name:"tool_result",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("result"in t))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:t}}},Nr={code:"b",name:"tool_call_streaming_start",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("toolName"in t)||typeof t.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:t}}},Dr={code:"c",name:"tool_call_delta",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("argsTextDelta"in t)||typeof t.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:t}}},kr={code:"d",name:"finish_message",parse:t=>{if(t==null||typeof t!="object"||!("finishReason"in t)||typeof t.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const e={finishReason:t.finishReason};return"usage"in t&&t.usage!=null&&typeof t.usage=="object"&&"promptTokens"in t.usage&&"completionTokens"in t.usage&&(e.usage={promptTokens:typeof t.usage.promptTokens=="number"?t.usage.promptTokens:Number.NaN,completionTokens:typeof t.usage.completionTokens=="number"?t.usage.completionTokens:Number.NaN}),{type:"finish_message",value:e}}},Or={code:"e",name:"finish_step",parse:t=>{if(t==null||typeof t!="object"||!("finishReason"in t)||typeof t.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const e={finishReason:t.finishReason,isContinued:!1};return"usage"in t&&t.usage!=null&&typeof t.usage=="object"&&"promptTokens"in t.usage&&"completionTokens"in t.usage&&(e.usage={promptTokens:typeof t.usage.promptTokens=="number"?t.usage.promptTokens:Number.NaN,completionTokens:typeof t.usage.completionTokens=="number"?t.usage.completionTokens:Number.NaN}),"isContinued"in t&&typeof t.isContinued=="boolean"&&(e.isContinued=t.isContinued),{type:"finish_step",value:e}}},Lr={code:"f",name:"start_step",parse:t=>{if(t==null||typeof t!="object"||!("messageId"in t)||typeof t.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:t.messageId}}}},Fr={code:"g",name:"reasoning",parse:t=>{if(typeof t!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:t}}},Pr={code:"h",name:"source",parse:t=>{if(t==null||typeof t!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:t}}},jr={code:"i",name:"redacted_reasoning",parse:t=>{if(t==null||typeof t!="object"||!("data"in t)||typeof t.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:t.data}}}},Vr={code:"j",name:"reasoning_signature",parse:t=>{if(t==null||typeof t!="object"||!("signature"in t)||typeof t.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:t.signature}}}},Mr={code:"k",name:"file",parse:t=>{if(t==null||typeof t!="object"||!("data"in t)||typeof t.data!="string"||!("mimeType"in t)||typeof t.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:t}}},te=[Tr,Rr,Ar,Cr,xr,vr,Nr,Dr,kr,Or,Lr,Fr,Pr,jr,Vr,Mr],Jr=Object.fromEntries(te.map(t=>[t.code,t]));Object.fromEntries(te.map(t=>[t.name,t.code]));var Ur=te.map(t=>t.code),Br=t=>{const e=t.indexOf(":");if(e===-1)throw new Error("Failed to parse stream string. No separator found.");const r=t.slice(0,e);if(!Ur.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const n=r,a=t.slice(e+1),i=JSON.parse(a);return Jr[n].parse(i)},Wr=10;function Yr(t,e){const r=new Uint8Array(e);let n=0;for(const a of t)r.set(a,n),n+=a.length;return t.length=0,r}async function $r({stream:t,onTextPart:e,onReasoningPart:r,onReasoningSignaturePart:n,onRedactedReasoningPart:a,onSourcePart:i,onFilePart:f,onDataPart:l,onErrorPart:s,onToolCallStreamingStartPart:o,onToolCallDeltaPart:p,onToolCallPart:u,onToolResultPart:g,onMessageAnnotationsPart:d,onFinishMessagePart:S,onFinishStepPart:y,onStartStepPart:V}){const h=t.getReader(),j=new TextDecoder,O=[];let v=0;for(;;){const{value:_}=await h.read();if(_&&(O.push(_),v+=_.length,_[_.length-1]!==Wr))continue;if(O.length===0)break;const c=Yr(O,v);v=0;const T=j.decode(c,{stream:!0}).split(`
`).filter(m=>m!=="").map(Br);for(const{type:m,value:I}of T)switch(m){case"text":await(e==null?void 0:e(I));break;case"reasoning":await(r==null?void 0:r(I));break;case"reasoning_signature":await(n==null?void 0:n(I));break;case"redacted_reasoning":await(a==null?void 0:a(I));break;case"file":await(f==null?void 0:f(I));break;case"source":await(i==null?void 0:i(I));break;case"data":await(l==null?void 0:l(I));break;case"error":await(s==null?void 0:s(I));break;case"message_annotations":await(d==null?void 0:d(I));break;case"tool_call_streaming_start":await(o==null?void 0:o(I));break;case"tool_call_delta":await(p==null?void 0:p(I));break;case"tool_call":await(u==null?void 0:u(I));break;case"tool_result":await(g==null?void 0:g(I));break;case"finish_message":await(S==null?void 0:S(I));break;case"finish_step":await(y==null?void 0:y(I));break;case"start_step":await(V==null?void 0:V(I));break;default:{const N=m;throw new Error(`Unknown stream part type: ${N}`)}}}}async function qr({stream:t,update:e,onToolCall:r,onFinish:n,generateId:a=Zt,getCurrentDate:i=()=>new Date,lastMessage:f}){var l,s;const o=(f==null?void 0:f.role)==="assistant";let p=o?1+((s=(l=f.toolInvocations)==null?void 0:l.reduce((c,T)=>{var m;return Math.max(c,(m=T.step)!=null?m:0)},0))!=null?s:0):0;const u=o?structuredClone(f):{id:a(),createdAt:i(),role:"assistant",content:"",parts:[]};let g,d,S;function y(c,T){const m=u.parts.find(I=>I.type==="tool-invocation"&&I.toolInvocation.toolCallId===c);m!=null?m.toolInvocation=T:u.parts.push({type:"tool-invocation",toolInvocation:T})}const V=[];let h=o?f==null?void 0:f.annotations:void 0;const j={};let O={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},v="unknown";function _(){const c=[...V];h!=null&&h.length&&(u.annotations=h);const T={...structuredClone(u),revisionId:a()};e({message:T,data:c,replaceLastMessage:o})}await $r({stream:t,onTextPart(c){g==null?(g={type:"text",text:c},u.parts.push(g)):g.text+=c,u.content+=c,_()},onReasoningPart(c){var T;S==null?(S={type:"text",text:c},d!=null&&d.details.push(S)):S.text+=c,d==null?(d={type:"reasoning",reasoning:c,details:[S]},u.parts.push(d)):d.reasoning+=c,u.reasoning=((T=u.reasoning)!=null?T:"")+c,_()},onReasoningSignaturePart(c){S!=null&&(S.signature=c.signature)},onRedactedReasoningPart(c){d==null&&(d={type:"reasoning",reasoning:"",details:[]},u.parts.push(d)),d.details.push({type:"redacted",data:c.data}),S=void 0,_()},onFilePart(c){u.parts.push({type:"file",mimeType:c.mimeType,data:c.data}),_()},onSourcePart(c){u.parts.push({type:"source",source:c}),_()},onToolCallStreamingStartPart(c){u.toolInvocations==null&&(u.toolInvocations=[]),j[c.toolCallId]={text:"",step:p,toolName:c.toolName,index:u.toolInvocations.length};const T={state:"partial-call",step:p,toolCallId:c.toolCallId,toolName:c.toolName,args:void 0};u.toolInvocations.push(T),y(c.toolCallId,T),_()},onToolCallDeltaPart(c){const T=j[c.toolCallId];T.text+=c.argsTextDelta;const{value:m}=ke(T.text),I={state:"partial-call",step:T.step,toolCallId:c.toolCallId,toolName:T.toolName,args:m};u.toolInvocations[T.index]=I,y(c.toolCallId,I),_()},async onToolCallPart(c){const T={state:"call",step:p,...c};if(j[c.toolCallId]!=null?u.toolInvocations[j[c.toolCallId].index]=T:(u.toolInvocations==null&&(u.toolInvocations=[]),u.toolInvocations.push(T)),y(c.toolCallId,T),_(),r){const m=await r({toolCall:c});if(m!=null){const I={state:"result",step:p,...c,result:m};u.toolInvocations[u.toolInvocations.length-1]=I,y(c.toolCallId,I),_()}}},onToolResultPart(c){const T=u.toolInvocations;if(T==null)throw new Error("tool_result must be preceded by a tool_call");const m=T.findIndex(N=>N.toolCallId===c.toolCallId);if(m===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const I={...T[m],state:"result",...c};T[m]=I,y(c.toolCallId,I),_()},onDataPart(c){V.push(...c),_()},onMessageAnnotationsPart(c){h==null?h=[...c]:h.push(...c),_()},onFinishStepPart(c){p+=1,g=c.isContinued?g:void 0,d=void 0,S=void 0},onStartStepPart(c){o||(u.id=c.messageId),u.parts.push({type:"step-start"}),_()},onFinishMessagePart(c){v=c.finishReason,c.usage!=null&&(O=br(c.usage))},onErrorPart(c){throw new Error(c)}}),n==null||n({message:u,finishReason:v,usage:O})}async function Kr({stream:t,onTextPart:e}){const r=t.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:n,value:a}=await r.read();if(n)break;await e(a)}}async function zr({stream:t,update:e,onFinish:r,getCurrentDate:n=()=>new Date,generateId:a=Zt}){const i={type:"text",text:""},f={id:a(),createdAt:n(),role:"assistant",content:"",parts:[i]};await Kr({stream:t,onTextPart:l=>{f.content+=l,i.text+=l,e({message:{...f},data:[],replaceLastMessage:!1})}}),r==null||r(f,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}var Hr=()=>fetch;async function Gr({api:t,body:e,streamProtocol:r="data",credentials:n,headers:a,abortController:i,restoreMessagesOnFailure:f,onResponse:l,onUpdate:s,onFinish:o,onToolCall:p,generateId:u,fetch:g=Hr(),lastMessage:d,requestType:S="generate"}){var y,V,h;const O=await(S==="resume"?g(`${t}?chatId=${e.id}`,{method:"GET",headers:{"Content-Type":"application/json",...a},signal:(y=i==null?void 0:i())==null?void 0:y.signal,credentials:n}):g(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...a},signal:(V=i==null?void 0:i())==null?void 0:V.signal,credentials:n})).catch(v=>{throw f(),v});if(l)try{await l(O)}catch(v){throw v}if(!O.ok)throw f(),new Error((h=await O.text())!=null?h:"Failed to fetch the chat response.");if(!O.body)throw new Error("The response body is empty.");switch(r){case"text":{await zr({stream:O.body,update:s,onFinish:o,generateId:u});return}case"data":{await qr({stream:O.body,update:s,lastMessage:d,onToolCall:p,onFinish({message:v,finishReason:_,usage:c}){o&&v!=null&&o(v,{usage:c,finishReason:_})},generateId:u});return}default:{const v=r;throw new Error(`Unknown stream protocol: ${v}`)}}}function Bt(t){return t==null?void 0:t.reduce((e,r)=>{var n;return Math.max(e,(n=r.step)!=null?n:0)},0)}function Oe(t){var e;return(e=t.parts)!=null?e:[...t.toolInvocations?t.toolInvocations.map(r=>({type:"tool-invocation",toolInvocation:r})):[],...t.reasoning?[{type:"reasoning",reasoning:t.reasoning,details:[{type:"text",text:t.reasoning}]}]:[],...t.content?[{type:"text",text:t.content}]:[]]}function kt(t){return t.map(e=>({...e,parts:Oe(e)}))}function Wt(t,e){if(t===e)return!0;if(t==null||e==null)return!1;if(typeof t!="object"&&typeof e!="object")return t===e;if(t.constructor!==e.constructor)return!1;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(Array.isArray(t)){if(t.length!==e.length)return!1;for(let a=0;a<t.length;a++)if(!Wt(t[a],e[a]))return!1;return!0}const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const a of r)if(!n.includes(a)||!Wt(t[a],e[a]))return!1;return!0}async function ue(t){if(!t)return[];if(globalThis.FileList&&t instanceof globalThis.FileList)return Promise.all(Array.from(t).map(async e=>{const{name:r,type:n}=e,a=await new Promise((i,f)=>{const l=new FileReader;l.onload=s=>{var o;i((o=s.target)==null?void 0:o.result)},l.onerror=s=>f(s),l.readAsDataURL(e)});return{name:r,contentType:n,url:a}}));if(Array.isArray(t))return t;throw new Error("Invalid attachments type")}function Xr({originalMaxToolInvocationStep:t,originalMessageCount:e,maxSteps:r,messages:n}){var a;const i=n[n.length-1];return r>1&&i!=null&&(n.length>e||Bt(i.toolInvocations)!==t)&&Le(i)&&((a=Bt(i.toolInvocations))!=null?a:0)<r}function Le(t){if(t.role!=="assistant")return!1;const e=t.parts.reduce((n,a,i)=>a.type==="step-start"?i:n,-1),r=t.parts.slice(e+1).filter(n=>n.type==="tool-invocation");return r.length>0&&r.every(n=>"result"in n.toolInvocation)}function Qr({messages:t,toolCallId:e,toolResult:r}){var n;const a=t[t.length-1],i=a.parts.find(l=>l.type==="tool-invocation"&&l.toolInvocation.toolCallId===e);if(i==null)return;const f={...i.toolInvocation,state:"result",result:r};i.toolInvocation=f,a.toolInvocations=(n=a.toolInvocations)==null?void 0:n.map(l=>l.toolCallId===e?f:l)}const Fe=0,Pe=1,je=2,fe=3;var de=Object.prototype.hasOwnProperty;function Yt(t,e){var r,n;if(t===e)return!0;if(t&&e&&(r=t.constructor)===e.constructor){if(r===Date)return t.getTime()===e.getTime();if(r===RegExp)return t.toString()===e.toString();if(r===Array){if((n=t.length)===e.length)for(;n--&&Yt(t[n],e[n]););return n===-1}if(!r||typeof t=="object"){n=0;for(r in t)if(de.call(t,r)&&++n&&!de.call(e,r)||!(r in e)||!Yt(t[r],e[r]))return!1;return Object.keys(e).length===n}}return t!==t&&e!==e}const tt=new WeakMap,nt=()=>{},U=nt(),$t=Object,C=t=>t===U,X=t=>typeof t=="function",st=(t,e)=>({...t,...e}),Ve=t=>X(t.then),Ot={},xt={},ee="undefined",wt=typeof window!=ee,qt=typeof document!=ee,Zr=wt&&"Deno"in window,tn=()=>wt&&typeof window.requestAnimationFrame!=ee,Me=(t,e)=>{const r=tt.get(t);return[()=>!C(e)&&t.get(e)||Ot,n=>{if(!C(e)){const a=t.get(e);e in xt||(xt[e]=a),r[5](e,st(a,n),a||Ot)}},r[6],()=>!C(e)&&e in xt?xt[e]:!C(e)&&t.get(e)||Ot]};let Kt=!0;const en=()=>Kt,[zt,Ht]=wt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[nt,nt],rn=()=>{const t=qt&&document.visibilityState;return C(t)||t!=="hidden"},nn=t=>(qt&&document.addEventListener("visibilitychange",t),zt("focus",t),()=>{qt&&document.removeEventListener("visibilitychange",t),Ht("focus",t)}),sn=t=>{const e=()=>{Kt=!0,t()},r=()=>{Kt=!1};return zt("online",e),zt("offline",r),()=>{Ht("online",e),Ht("offline",r)}},an={isOnline:en,isVisible:rn},on={initFocus:nn,initReconnect:sn},pe=!Qt.useId,It=!wt||Zr,cn=t=>tn()?window.requestAnimationFrame(t):setTimeout(t,1),Lt=It?R.useEffect:R.useLayoutEffect,Ft=typeof navigator<"u"&&navigator.connection,he=!It&&Ft&&(["slow-2g","2g"].includes(Ft.effectiveType)||Ft.saveData),vt=new WeakMap,Pt=(t,e)=>$t.prototype.toString.call(t)===`[object ${e}]`;let ln=0;const Gt=t=>{const e=typeof t,r=Pt(t,"Date"),n=Pt(t,"RegExp"),a=Pt(t,"Object");let i,f;if($t(t)===t&&!r&&!n){if(i=vt.get(t),i)return i;if(i=++ln+"~",vt.set(t,i),Array.isArray(t)){for(i="@",f=0;f<t.length;f++)i+=Gt(t[f])+",";vt.set(t,i)}if(a){i="#";const l=$t.keys(t).sort();for(;!C(f=l.pop());)C(t[f])||(i+=f+":"+Gt(t[f])+",");vt.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},re=t=>{if(X(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?Gt(t):"",[t,e]};let un=0;const Xt=()=>++un;async function Je(...t){const[e,r,n,a]=t,i=st({populateCache:!0,throwOnError:!0},typeof a=="boolean"?{revalidate:a}:a||{});let f=i.populateCache;const l=i.rollbackOnError;let s=i.optimisticData;const o=g=>typeof l=="function"?l(g):l!==!1,p=i.throwOnError;if(X(r)){const g=r,d=[],S=e.keys();for(const y of S)!/^\$(inf|sub)\$/.test(y)&&g(e.get(y)._k)&&d.push(y);return Promise.all(d.map(u))}return u(r);async function u(g){const[d]=re(g);if(!d)return;const[S,y]=Me(e,d),[V,h,j,O]=tt.get(e),v=()=>{const F=V[d];return(X(i.revalidate)?i.revalidate(S().data,g):i.revalidate!==!1)&&(delete j[d],delete O[d],F&&F[0])?F[0](je).then(()=>S().data):S().data};if(t.length<3)return v();let _=n,c;const T=Xt();h[d]=[T,0];const m=!C(s),I=S(),N=I.data,z=I._c,K=C(z)?N:z;if(m&&(s=X(s)?s(K,N):s,y({data:s,_c:K})),X(_))try{_=_(K)}catch(F){c=F}if(_&&Ve(_))if(_=await _.catch(F=>{c=F}),T!==h[d][0]){if(c)throw c;return _}else c&&m&&o(c)&&(f=!0,y({data:K,_c:U}));if(f&&!c)if(X(f)){const F=f(_,K);y({data:F,error:U,_c:U})}else y({data:_,error:U,_c:U});if(h[d][1]=Xt(),Promise.resolve(v()).then(()=>{y({_c:U})}),c){if(p)throw c;return}return _}}const ge=(t,e)=>{for(const r in t)t[r][0]&&t[r][0](e)},fn=(t,e)=>{if(!tt.has(t)){const r=st(on,e),n=Object.create(null),a=Je.bind(U,t);let i=nt;const f=Object.create(null),l=(p,u)=>{const g=f[p]||[];return f[p]=g,g.push(u),()=>g.splice(g.indexOf(u),1)},s=(p,u,g)=>{t.set(p,u);const d=f[p];if(d)for(const S of d)S(u,g)},o=()=>{if(!tt.has(t)&&(tt.set(t,[n,Object.create(null),Object.create(null),Object.create(null),a,s,l]),!It)){const p=r.initFocus(setTimeout.bind(U,ge.bind(U,n,Fe))),u=r.initReconnect(setTimeout.bind(U,ge.bind(U,n,Pe)));i=()=>{p&&p(),u&&u(),tt.delete(t)}}};return o(),[t,a,o,i]}return[t,tt.get(t)[4]]},dn=(t,e,r,n,a)=>{const i=r.errorRetryCount,f=a.retryCount,l=~~((Math.random()+.5)*(1<<(f<8?f:8)))*r.errorRetryInterval;!C(i)&&f>i||setTimeout(n,l,a)},pn=Yt,[Ue,hn]=fn(new Map),gn=st({onLoadingSlow:nt,onSuccess:nt,onError:nt,onErrorRetry:dn,onDiscarded:nt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:he?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:he?5e3:3e3,compare:pn,isPaused:()=>!1,cache:Ue,mutate:hn,fallback:{}},an),mn=(t,e)=>{const r=st(t,e);if(e){const{use:n,fallback:a}=t,{use:i,fallback:f}=e;n&&i&&(r.use=n.concat(i)),a&&f&&(r.fallback=st(a,f))}return r},yn=R.createContext({}),En="$inf$",Be=wt&&window.__SWR_DEVTOOLS_USE__,_n=Be?window.__SWR_DEVTOOLS_USE__:[],In=()=>{Be&&(window.__SWR_DEVTOOLS_REACT__=Qt)},wn=t=>X(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],bn=()=>st(gn,R.useContext(yn)),Sn=t=>(e,r,n)=>t(e,r&&((...i)=>{const[f]=re(e),[,,,l]=tt.get(Ue);if(f.startsWith(En))return r(...i);const s=l[f];return C(s)?r(...i):(delete l[f],s)}),n),Tn=_n.concat(Sn),Rn=t=>function(...r){const n=bn(),[a,i,f]=wn(r),l=mn(n,f);let s=t;const{use:o}=l,p=(o||[]).concat(Tn);for(let u=p.length;u--;)s=p[u](s);return s(a,i||l.fetcher||null,l)},An=(t,e,r)=>{const n=e[t]||(e[t]=[]);return n.push(r),()=>{const a=n.indexOf(r);a>=0&&(n[a]=n[n.length-1],n.pop())}};In();const jt=Qt.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),Vt={dedupe:!0},Cn=(t,e,r)=>{const{cache:n,compare:a,suspense:i,fallbackData:f,revalidateOnMount:l,revalidateIfStale:s,refreshInterval:o,refreshWhenHidden:p,refreshWhenOffline:u,keepPreviousData:g}=r,[d,S,y,V]=tt.get(n),[h,j]=re(t),O=R.useRef(!1),v=R.useRef(!1),_=R.useRef(h),c=R.useRef(e),T=R.useRef(r),m=()=>T.current,I=()=>m().isVisible()&&m().isOnline(),[N,z,K,F]=Me(n,h),B=R.useRef({}).current,H=C(f)?C(r.fallback)?U:r.fallback[h]:f,bt=(w,E)=>{for(const x in B){const b=x;if(b==="data"){if(!a(w[b],E[b])&&(!C(w[b])||!a(lt,E[b])))return!1}else if(E[b]!==w[b])return!1}return!0},it=R.useMemo(()=>{const w=!h||!e?!1:C(l)?m().isPaused()||i?!1:s!==!1:l,E=D=>{const $=st(D);return delete $._k,w?{isValidating:!0,isLoading:!0,...$}:$},x=N(),b=F(),P=E(x),Y=x===b?P:E(b);let k=P;return[()=>{const D=E(N());return bt(D,k)?(k.data=D.data,k.isLoading=D.isLoading,k.isValidating=D.isValidating,k.error=D.error,k):(k=D,D)},()=>Y]},[n,h]),M=tr.useSyncExternalStore(R.useCallback(w=>K(h,(E,x)=>{bt(x,E)||w()}),[n,h]),it[0],it[1]),G=!O.current,W=d[h]&&d[h].length>0,et=M.data,Q=C(et)?H&&Ve(H)?jt(H):H:et,ct=M.error,pt=R.useRef(Q),lt=g?C(et)?C(pt.current)?Q:pt.current:et:Q,St=W&&!C(ct)?!1:G&&!C(l)?l:m().isPaused()?!1:i?C(Q)?!1:s:C(Q)||s,rt=!!(h&&e&&G&&St),ht=C(M.isValidating)?rt:M.isValidating,Dt=C(M.isLoading)?rt:M.isLoading,at=R.useCallback(async w=>{const E=c.current;if(!h||!E||v.current||m().isPaused())return!1;let x,b,P=!0;const Y=w||{},k=!y[h]||!Y.dedupe,D=()=>pe?!v.current&&h===_.current&&O.current:h===_.current,$={isValidating:!1,isLoading:!1},Rt=()=>{z($)},At=()=>{const J=y[h];J&&J[1]===b&&delete y[h]},Ct={isValidating:!0};C(N().data)&&(Ct.isLoading=!0);try{if(k&&(z(Ct),r.loadingTimeout&&C(N().data)&&setTimeout(()=>{P&&D()&&m().onLoadingSlow(h,r)},r.loadingTimeout),y[h]=[E(j),Xt()]),[x,b]=y[h],x=await x,k&&setTimeout(At,r.dedupingInterval),!y[h]||y[h][1]!==b)return k&&D()&&m().onDiscarded(h),!1;$.error=U;const J=S[h];if(!C(J)&&(b<=J[0]||b<=J[1]||J[1]===0))return Rt(),k&&D()&&m().onDiscarded(h),!1;const q=N().data;$.data=a(q,x)?q:x,k&&D()&&m().onSuccess(x,h,r)}catch(J){At();const q=m(),{shouldRetryOnError:Z}=q;q.isPaused()||($.error=J,k&&D()&&(q.onError(J,h,q),(Z===!0||X(Z)&&Z(J))&&(!m().revalidateOnFocus||!m().revalidateOnReconnect||I())&&q.onErrorRetry(J,h,q,ut=>{const ft=d[h];ft&&ft[0]&&ft[0](fe,ut)},{retryCount:(Y.retryCount||0)+1,dedupe:!0})))}return P=!1,Rt(),!0},[h,n]),Tt=R.useCallback((...w)=>Je(n,_.current,...w),[]);if(Lt(()=>{c.current=e,T.current=r,C(et)||(pt.current=et)}),Lt(()=>{if(!h)return;const w=at.bind(U,Vt);let E=0;m().revalidateOnFocus&&(E=Date.now()+m().focusThrottleInterval);const b=An(h,d,(P,Y={})=>{if(P==Fe){const k=Date.now();m().revalidateOnFocus&&k>E&&I()&&(E=k+m().focusThrottleInterval,w())}else if(P==Pe)m().revalidateOnReconnect&&I()&&w();else{if(P==je)return at();if(P==fe)return at(Y)}});return v.current=!1,_.current=h,O.current=!0,z({_k:j}),St&&(C(Q)||It?w():cn(w)),()=>{v.current=!0,b()}},[h]),Lt(()=>{let w;function E(){const b=X(o)?o(N().data):o;b&&w!==-1&&(w=setTimeout(x,b))}function x(){!N().error&&(p||m().isVisible())&&(u||m().isOnline())?at(Vt).then(E):E()}return E(),()=>{w&&(clearTimeout(w),w=-1)}},[o,p,u,h]),R.useDebugValue(lt),i&&C(Q)&&h){if(!pe&&It)throw new Error("Fallback data is required when using Suspense in SSR.");c.current=e,T.current=r,v.current=!1;const w=V[h];if(!C(w)){const E=Tt(w);jt(E)}if(C(ct)){const E=at(Vt);C(lt)||(E.status="fulfilled",E.value=!0),jt(E)}else throw ct}return{mutate:Tt,get data(){return B.data=!0,lt},get error(){return B.error=!0,ct},get isValidating(){return B.isValidating=!0,ht},get isLoading(){return B.isLoading=!0,Dt}}},Nt=Rn(Cn);var Mt,me;function xn(){if(me)return Mt;me=1;function t(e,r){if(typeof e!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let n,a=0;return function(...f){clearTimeout(n);const l=Date.now(),s=l-a,o=r-s;o<=0?(a=l,e.apply(this,f)):n=setTimeout(()=>{a=Date.now(),e.apply(this,f)},o)}}return Mt=t,Mt}var vn=xn();const Nn=Ee(vn);function ye(t,e){return e!=null?Nn(t,e):t}function Dn(t){const[e,r]=R.useState(t);return R.useEffect(()=>{Wt(t,e)||r(t)},[t,e]),e}function kn({api:t="/api/chat",id:e,initialMessages:r,initialInput:n="",sendExtraMessageFields:a,onToolCall:i,experimental_prepareRequestBody:f,maxSteps:l=1,streamProtocol:s="data",onResponse:o,onFinish:p,onError:u,credentials:g,headers:d,body:S,generateId:y=Zt,fetch:V,keepLastMessageOnError:h=!0,experimental_throttle:j}={}){const[O]=R.useState(y),v=e??O,_=typeof t=="string"?[t,v]:v,c=Dn(r??[]),T=R.useMemo(()=>kt(c),[c]),{data:m,mutate:I}=Nt([_,"messages"],null,{fallbackData:T}),N=R.useRef(m||[]);R.useEffect(()=>{N.current=m||[]},[m]);const{data:z,mutate:K}=Nt([_,"streamData"],null),F=R.useRef(z);R.useEffect(()=>{F.current=z},[z]);const{data:B="ready",mutate:H}=Nt([_,"status"],null),{data:bt=void 0,mutate:it}=Nt([_,"error"],null),M=R.useRef(null),G=R.useRef({credentials:g,headers:d,body:S});R.useEffect(()=>{G.current={credentials:g,headers:d,body:S}},[g,d,S]);const W=R.useCallback(async(A,w="generate")=>{var E,x;H("submitted"),it(void 0);const b=kt(A.messages),P=b.length,Y=Bt((E=b[b.length-1])==null?void 0:E.toolInvocations);try{const D=new AbortController;M.current=D;const $=ye(I,j),Rt=ye(K,j),At=N.current;$(b,!1);const Ct=a?b:b.map(({role:q,content:Z,experimental_attachments:ut,data:ft,annotations:ne,toolInvocations:se,parts:ae})=>({role:q,content:Z,...ut!==void 0&&{experimental_attachments:ut},...ft!==void 0&&{data:ft},...ne!==void 0&&{annotations:ne},...se!==void 0&&{toolInvocations:se},...ae!==void 0&&{parts:ae}})),J=F.current;await Gr({api:t,body:(x=f==null?void 0:f({id:v,messages:b,requestData:A.data,requestBody:A.body}))!=null?x:{id:v,messages:Ct,data:A.data,...G.current.body,...A.body},streamProtocol:s,credentials:G.current.credentials,headers:{...G.current.headers,...A.headers},abortController:()=>M.current,restoreMessagesOnFailure(){h||$(At,!1)},onResponse:o,onUpdate({message:q,data:Z,replaceLastMessage:ut}){H("streaming"),$([...ut?b.slice(0,b.length-1):b,q],!1),Z!=null&&Z.length&&Rt([...J??[],...Z],!1)},onToolCall:i,onFinish:p,generateId:y,fetch:V,lastMessage:b[b.length-1],requestType:w}),M.current=null,H("ready")}catch(D){if(D.name==="AbortError")return M.current=null,H("ready"),null;u&&D instanceof Error&&u(D),it(D),H("error")}const k=N.current;Xr({originalMaxToolInvocationStep:Y,originalMessageCount:P,maxSteps:l,messages:k})&&await W({messages:k})},[I,H,t,G,o,p,u,it,K,F,s,a,f,i,l,N,M,y,V,h,j,v]),et=R.useCallback(async(A,{data:w,headers:E,body:x,experimental_attachments:b=A.experimental_attachments}={})=>{var P,Y;const k=await ue(b),D=N.current.concat({...A,id:(P=A.id)!=null?P:y(),createdAt:(Y=A.createdAt)!=null?Y:new Date,experimental_attachments:k.length>0?k:void 0,parts:Oe(A)});return W({messages:D,headers:E,body:x,data:w})},[W,y]),Q=R.useCallback(async({data:A,headers:w,body:E}={})=>{const x=N.current;if(x.length===0)return null;const b=x[x.length-1];return W({messages:b.role==="assistant"?x.slice(0,-1):x,headers:w,body:E,data:A})},[W]),ct=R.useCallback(()=>{M.current&&(M.current.abort(),M.current=null)},[]),pt=R.useCallback(async()=>{const A=N.current;W({messages:A},"resume")},[W]),lt=R.useCallback(A=>{typeof A=="function"&&(A=A(N.current));const w=kt(A);I(w,!1),N.current=w},[I]),St=R.useCallback(A=>{typeof A=="function"&&(A=A(F.current)),K(A,!1),F.current=A},[K]),[rt,ht]=R.useState(n),Dt=R.useCallback(async(A,w={},E)=>{var x;if((x=A==null?void 0:A.preventDefault)==null||x.call(A),!rt&&!w.allowEmptySubmit)return;E&&(G.current={...G.current,...E});const b=await ue(w.experimental_attachments),Y={messages:N.current.concat({id:y(),createdAt:new Date,role:"user",content:rt,experimental_attachments:b.length>0?b:void 0,parts:[{type:"text",text:rt}]}),headers:w.headers,body:w.body,data:w.data};W(Y),ht("")},[rt,y,W]),at=A=>{ht(A.target.value)},Tt=R.useCallback(({toolCallId:A,result:w})=>{const E=N.current;if(Qr({messages:E,toolCallId:A,toolResult:w}),I([...E.slice(0,E.length-1),{...E[E.length-1]}],!1),B==="submitted"||B==="streaming")return;const x=E[E.length-1];Le(x)&&W({messages:E})},[I,B,W]);return{messages:m??[],id:v,setMessages:lt,data:z,setData:St,error:bt,append:et,reload:Q,stop:ct,experimental_resume:pt,input:rt,setInput:ht,handleInputChange:at,handleSubmit:Dt,isLoading:B==="submitted"||B==="streaming",status:B,addToolResult:Tt}}const On=$e("src_lib_handlers_chat_ts--getChatResponseFn_createServerFn_handler","/_serverFn"),Ln=Ye({method:"POST",response:"raw"}).handler(On),Fn=t=>{const e=ke(t.content),{value:r,state:n}=e;if(r&&["repaired-parse","successful-parse"].includes(n))return r},Mn=({initialMessages:t=[],scenarioId:e,personaId:r,contextIds:n,instructions:a,onChange:i})=>{const f=qe("Chat"),{append:l,status:s,messages:o}=kn({initialMessages:t,fetch:(g,d)=>{const S=JSON.parse(d.body);return Ln({data:S})}}),p=Ke({defaultValues:{content:""},validators:{onSubmit:ze({content:He().min(1)})},onSubmit:({value:{content:g},formApi:d})=>{l({role:"user",content:g},{body:{personaId:r,scenarioId:e,contextIds:n}}),d.reset()}}),u=o.slice().reverse();return R.useEffect(()=>{s!=="ready"||!i||o.length===(t==null?void 0:t.length)||i(o)},[o,s]),L.jsxs("div",{className:"flex h-full justify-start gap-2 overflow-y-auto p-4 scroll-p-8 flex-col-reverse w-full",children:[a&&L.jsx("div",{className:"border flex flex-col gap-2",children:L.jsxs(Ge,{defaultOpen:!0,children:[L.jsx(Xe,{asChild:!0,children:L.jsxs(Qe,{variant:"ghost",size:"sm",className:"w-full flex items-center justify-between",children:[L.jsxs("p",{className:"flex items-center gap-2",children:[L.jsx(nr,{className:"size-4"}),"Instructions"]}),L.jsx(er,{className:"size-4"})]})}),L.jsx(Ze,{className:"pt-2 text-sm text-muted-foreground p-2",children:a})]})}),L.jsx(p.AppForm,{children:L.jsx("form",{onSubmit:g=>g.preventDefault(),className:"flex flex-col gap-4",children:L.jsx(p.AppField,{name:"content",children:g=>L.jsx(g.TextAreaField,{placeholder:f.placeholder,label:"",className:"resize-none z-20",onKeyDown:d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),console.log("submit",s),s==="ready"&&p.handleSubmit())}})})})}),L.jsx("div",{className:"flex flex-col-reverse gap-8 py-8",children:u.map(g=>{if(g.role==="user")return L.jsx("div",{className:"self-end bg-blue-500 text-white px-3 py-2 sm:max-w-[70%] max-w-[90%] whitespace-pre-line",children:g.content},g.id);const d=Fn(g);return d?L.jsxs("div",{className:"self-start flex-col flex gap-2",children:[L.jsx("p",{className:"whitespace-pre-line",children:d==null?void 0:d.content}),(d.stats&&d.stats.length>0||d.evaluations&&d.evaluations.length>0)&&L.jsxs("div",{className:"border px-3 py-2 flex flex-col gap-2",children:[d.stats&&d.stats.map((S,y)=>L.jsxs("p",{children:[S.name," (",S.value,")"]},y)),d.evaluations&&d.evaluations.map((S,y)=>L.jsxs("p",{children:[S.name," (",S.value,")"]},y))]})]},g.id):null})})]})};export{Mn as C};
